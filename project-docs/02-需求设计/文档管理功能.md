# 文档管理功能设计

## 📋 需求概述

为Dodo项目添加文档和目录管理功能，让用户可以在project-docs目录结构中创建和 organize 文档。

## 🎯 核心需求

### 1. 目录创建功能
- **位置限制**：只能在project-docs根目录下创建子目录
- **层级限制**：不支持多级目录（不支持子目录的子目录）
- **目录命名**：支持中文和英文名称，需要符合文件系统命名规范
- **唯一性检查**：确保目录名不与现有目录或文档冲突

### 2. 文档创建功能
- **位置限制**：在特定目录下创建.md文档
- **文件类型**：仅支持Markdown文档（.md文件）
- **模板选项**：暂不需要文档模板，创建空白文档
- **命名规范**：文档名需要.md后缀，避免特殊字符

## 🔧 技术方案设计

### 1. 数据结构设计

#### 目录数据模型
```typescript
interface DirectoryInfo {
  name: string          // 目录名称
  path: string           // 完整路径 (如 "01-项目章程")
  type: 'directory'      // 类型标识
  fileCount: number       // 包含的文档数量
  created: Date         // 创建时间
  modified: Date        // 修改时间
}

#### 文档数据模型（扩展现有）
```typescript
interface Document {
  id: string
  path: string           // 完整路径，包含目录 (如 "01-项目章程/项目章程.md")
  title: string          // 文档标题（不带路径）
  content: string        // 文档内容
  directory: string      // 所属目录 (如 "01-项目章程")
  created: Date         // 创建时间
  modified: Date        // 修改时间
  modifiedBy: 'ai' | 'human'
}
```

### 2. 界面设计方案

#### 2.1 侧边栏布局结构
```
Sidebar (左侧边栏)
├── Header
│   ├── "Dodo" 标题
│   ├── 搜索框
│   └── 创建按钮组
├── project-docs 目录列表
│   ├── 目录项 (可展开/折叠)
│   │   ├── 目录名
│   │   ├── 文档数量统计
│   │   └── 创建文档按钮 (右侧)
│   └── 文档项
│       ├── 文档名
│       └── 文档预览信息
└── Footer
    └── 统计信息
```

#### 2.2 目录创建UI
- **位置**：每个目录行的顶部
- **按钮**：目录名称左侧的"+"按钮
- **交互**：点击按钮弹出创建对话框

#### 2.3 文档创建UI
- **位置**：每个目录行的右侧"+"按钮
- **交互**：点击按钮弹出创建对话框
- **视觉反馈**：hover时显示创建提示

### 3. 交互流程设计

#### 3.1 创建目录流程
```
1. 用户点击目录名称左侧的"+"按钮
2. 弹出创建目录对话框
3. 用户输入目录名称
4. 系统验证：
   - 名称不为空
   - 名称不包含特殊字符
   - 名称与现有目录/文档不冲突
5. 创建目录成功
6. 更新侧边栏显示
7. 创建初始化README.md文档
```

#### 3.2 创建文档流程
```
1. 用户点击目录右侧的"+"按钮
2. 弹出创建文档对话框
3. 用户输入文档名称（不含.md）
4. 系统验证：
   - 名称不为空
   - 名称不包含特殊字符
   - 名称与现有文档不冲突
5. 创建文档成功
6. 在指定目录下创建.md文件
7. 自动打开新文档进行编辑
```

### 4. 技术实现方案

#### 4.1 文件系统接口
```typescript
// 文件系统服务
class FileSystemService {
  // 创建目录
  static async createDirectory(dirName: string): Promise<void>

  // 创建文档
  static async createDocument(directory: string, fileName: string): Promise<void>

  // 读取目录列表
  static async listDirectory(path: string): Promise<DirectoryInfo[]>

  // 读取文档
  static async readDocument(path: string): Promise<string>

  // 删除目录
  static async deleteDirectory(path: string): Promise<void>

  // 删除文档
  static async deleteDocument(path: string): Promise<void>
}
```

#### 4.2 状态管理
```typescript
// 文件系统状态管理
interface FileSystemStore {
  // 当前目录列表
  directories: DirectoryInfo[]

  // 当前选中的目录
  selectedDirectory: string | null

  // 加载目录列表
  loadDirectories: () => Promise<void>

  // 创建目录
  createDirectory: (name: string) => Promise<void>

  // 创建文档
  createDocument: (directory: string, name: string) => Promise<void>

  // 删除目录
  deleteDirectory: (path: string) => Promise<void>

  // 选择目录
  selectDirectory: (path: string) => void
}
```

#### 4.3 UI组件设计

##### DirectoryItem 组件
```typescript
interface DirectoryItemProps {
  directory: DirectoryInfo
  onCreateDocument: () => void
  onSelect: (path: string) => void
  onDelete: () => void
}

// 显示：
// [+] 目录名称 (3个文档)
//    └── [+ 创建文档按钮
```

##### CreateDirectoryModal 组件
```typescript
interface CreateDirectoryModalProps {
  isOpen: boolean
  onClose: () => void
  onCreate: (name: string) => void
  existingNames: string[]
}

// 表单：
// 输入框：目录名称
// 按钮：[取消] [创建]
// 验证提示
```

##### CreateDocumentModal 组件
```typescript
interface CreateDocumentModalProps {
  isOpen: boolean
  onClose: () => void
  onCreate: (name: string) => void
  existingNames: string[]
  directory: string
}

// 表单：
// 输入框：文档名称
// 提示：将在 "目录名" 下创建文档
// 按钮：[取消] [创建]
```

### 5. 验证规则

#### 5.1 目录名验证
- **必填验证**：名称不能为空
- **字符限制**：不允许包含 `<>:"/\|?*` 等特殊字符
- **长度限制**：1-50个字符
- **唯一性验证**：不能与现有目录或文档重名

#### 5.2 文档名验证
- **必填验证**：名称不能为空
- **字符限制**：不允许包含特殊字符
- **长度限制**：1-100个字符
- **唯一性验证**：不能与现有文档重名
- **后缀处理**：自动添加.md后缀

### 6. 错误处理

#### 6.1 前端验证错误
- 输入验证失败的提示信息
- 重复名称的错误提示
- 字符验证的友好提示

#### 6.2 后端错误处理
- 文件系统权限错误的处理
- 磁盘空间不足的处理
- 文件创建失败的错误提示

### 7. 成功反馈

#### 7.1 创建成功提示
- 目录创建成功的Toast通知
- 文档创建成功并自动打开
- 更新侧边栏目录列表

#### 7.2 视觉反馈
- 创建按钮的加载状态
- 新创建项的高亮显示
- 目录项的计数更新

## 🎯 验收标准

### 功能验收
- [ ] 可以在project-docs根目录下创建目录
- [ ] 可以在指定目录下创建.md文档
- [ ] 目录和文档名称冲突时有错误提示
- [ ] 创建文档后自动打开编辑界面
- [ ] 创建成功后有视觉反馈

### 用户体验验收
- [ ] 操作按钮位置符合设计要求
- [ ] 对话框交互流畅
- [ ] 错误提示清晰友好
- [ ] 成功反馈及时准确

### 技术验收
- [ ] 文件系统操作正常
- [ ] 状态管理数据一致
- [ ] 错误处理完善
- [ ] 性能响应良好

## 📅 实施计划

### 阶段1：基础架构 (1-2天)
- 设计和实现文件系统接口
- 创建状态管理store
- 实现基础UI组件

### 阶段2：核心功能 (2-3天)
- 实现目录创建功能
- 实现文档创建功能
- 添加验证规则

### 阶段3：用户体验 (1-2天)
- 优化交互体验
- 完善错误处理
- 添加成功反馈

### 阶段4：集成测试 (1天)
- 集成到现有侧边栏
- 完整功能测试
- 性能优化

## 🔗 相关文档

- `03-技术设计/架构设计.md` - 系统架构设计
- `04-开发实施/任务清单.md` - 详细任务分解
- `05-项目参考/变更日志.md` - 功能变更记录

---

*本文档设计遵循"文档即契约"的原则，是文档管理功能开发的技术规格说明。所有实现都应严格遵循本文档的设计要求和验收标准。*