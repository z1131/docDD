# é›¶é…ç½®è‡ªåŠ¨åŒ–å’Œå¯è§†åŒ–è§¦å‘æ–¹æ¡ˆ

## è®¾è®¡ç›®æ ‡

è§£å†³ç”¨æˆ·ä½¿ç”¨ DocDD æ—¶çš„é…ç½®å¤æ‚æ€§é—®é¢˜ï¼Œå®ç°ï¼š
1. **æœ€å°åŒ–é…ç½®**ï¼šç”¨æˆ·å‡ ä¹ä¸éœ€è¦æ‰‹åŠ¨é…ç½®å³å¯ä½¿ç”¨
2. **è‡ªåŠ¨ Claude Code é›†æˆ**ï¼šè‡ªåŠ¨å®Œæˆ MCP é…ç½®å’Œå¯åŠ¨
3. **å¯è§†åŒ– AI ä»»åŠ¡è§¦å‘**ï¼šæ–‡æ¡£ä¿®æ”¹åï¼Œå¯è§†åŒ–ç•Œé¢è§¦å‘ AI ä»»åŠ¡æ‰§è¡Œ
4. **æ™ºèƒ½æ¨è**ï¼šè‡ªåŠ¨åˆ†ææ–‡æ¡£å˜æ›´ï¼Œæ¨èç›¸å…³ AI ä»»åŠ¡

## å½“å‰ç—›ç‚¹åˆ†æ

### ç—›ç‚¹ 1ï¼šé…ç½®å¤æ‚

```bash
# å½“å‰ç”¨æˆ·éœ€è¦åšçš„ï¼š
1. å…‹éš†é¡¹ç›®
2. npm install
3. æ‰‹åŠ¨åˆ›å»º .claude.json
4. æ‰‹åŠ¨é…ç½® MCP è·¯å¾„
5. å¯åŠ¨ä¸¤ä¸ªæœåŠ¡ï¼ˆnpm run dev + npm run mcpï¼‰
```

**é—®é¢˜**ï¼š
- æ­¥éª¤å¤ªå¤šï¼Œå®¹æ˜“å‡ºé”™
- éœ€è¦ç†è§£ MCP æ¦‚å¿µ
- éœ€è¦åŒæ—¶ç®¡ç†å¤šä¸ªè¿›ç¨‹

### ç—›ç‚¹ 2ï¼šä»»åŠ¡è§¦å‘ä¸ç›´è§‚

**é—®é¢˜**ï¼š
- æ–‡æ¡£ä¿®æ”¹åï¼Œç”¨æˆ·ä¸çŸ¥é“éœ€è¦æ‰§è¡Œå“ªäº› AI ä»»åŠ¡
- éœ€è¦æ‰‹åŠ¨åœ¨ Claude Code ä¸­æè¿°ä»»åŠ¡
- æ— æ³•å¯è§†åŒ–é€‰æ‹©ä»»åŠ¡ç±»å‹

### ç—›ç‚¹ 3ï¼šç¯å¢ƒä¾èµ–

```bash
# éœ€è¦å®‰è£…ï¼š
- Node.js 18+
- npm/pnpm
- Claude Code CLI
- å¯èƒ½è¿˜éœ€è¦ TypeScript
```

**é—®é¢˜**ï¼š
- ä¸åŒç”¨æˆ·çš„å¼€å‘ç¯å¢ƒä¸åŒ
- é…ç½®ç¯å¢ƒè€—æ—¶ä¸”å®¹æ˜“å‡ºé”™
- éæŠ€æœ¯ç”¨æˆ·éš¾ä»¥ä½¿ç”¨

---

## ç›®æ ‡ç”¨æˆ·ä½“éªŒ

### ç†æƒ³æµç¨‹

```bash
# ç”¨æˆ·åªéœ€ä¸€æ­¥ï¼š
npx docdd init

# ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼š
âœ“ æ£€æŸ¥ç¯å¢ƒ
âœ“ å®‰è£…ä¾èµ–
âœ“ åˆ›å»ºé…ç½®æ–‡ä»¶
âœ“ å¯åŠ¨ DocDD
âœ“ é›†æˆ Claude Code
âœ“ æ‰“å¼€æµè§ˆå™¨

# ç”¨æˆ·çœ‹åˆ°ï¼š
ğŸ“ DocDD å·²å¯åŠ¨ï¼šhttp://localhost:5175
ğŸ¤– MCP å·²é›†æˆåˆ° Claude Code
ğŸ“‚ æ­£åœ¨ç›‘è§† docs/ ç›®å½•

# åœ¨ Web UI ä¸­ï¼š
- ç¼–è¾‘æ–‡æ¡£
- ç‚¹å‡»"æ™ºèƒ½ä»»åŠ¡"æŒ‰é’®
- é€‰æ‹©ä»»åŠ¡ç±»å‹
- AI è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡
- æŸ¥çœ‹æ‰§è¡Œç»“æœ
```

---

## è§£å†³æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆ 1ï¼šä¸€é”®åˆå§‹åŒ–å‘½ä»¤è¡Œå·¥å…·

**å®ç°**ï¼š`docdd init`

#### æŠ€æœ¯å®ç°

```typescript
// src/cli/init.ts
export class InitCommand {
  async run(): Promise<void> {
    console.log('ğŸš€ DocDD åˆå§‹åŒ–...\n')

    // 1. æ£€æŸ¥ç¯å¢ƒ
    await this.checkEnvironment()

    // 2. å®‰è£…ä¾èµ–
    await this.installDependencies()

    // 3. æ£€æµ‹é¡¹ç›®ç±»å‹
    const projectType = await this.detectProjectType()

    // 4. è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶
    await this.generateConfig(projectType)

    // 5. å¯åŠ¨æœåŠ¡
    await this.startServices()

    // 6. é›†æˆ Claude Code
    await this.integrateClaudeCode()

    console.log('\nâœ… DocDD åˆå§‹åŒ–å®Œæˆï¼')
    console.log('ğŸ“– è®¿é—® http://localhost:5175 å¼€å§‹ç¼–è¾‘æ–‡æ¡£')
    console.log('ğŸ¤– åœ¨ç»ˆç«¯è¾“å…¥ `claude` å¯åŠ¨ AI ç¼–ç¨‹åŠ©æ‰‹')
  }

  /**
   * æ£€æŸ¥ç¯å¢ƒ
   */
  private async checkEnvironment(): Promise<void> {
    console.log('1. æ£€æŸ¥ç¯å¢ƒ...')

    // æ£€æŸ¥ Node.js ç‰ˆæœ¬
    const nodeVersion = process.version
    const majorVersion = parseInt(nodeVersion.slice(1).split('.')[0])

    if (majorVersion < 18) {
      throw new Error(`Node.js ç‰ˆæœ¬è¿‡ä½ï¼Œéœ€è¦ 18+ï¼Œå½“å‰: ${nodeVersion}`)
    }

    console.log('   âœ“ Node.js:', nodeVersion)

    // æ£€æŸ¥ Claude Code
    try {
      execSync('which claude', { stdio: 'ignore' })
      console.log('   âœ“ Claude Code å·²å®‰è£…')
    } catch {
      console.log('   âš  Claude Code æœªå®‰è£…ï¼Œå°†è·³è¿‡é›†æˆ')
    }
  }

  /**
   * å®‰è£…ä¾èµ–
   */
  private async installDependencies(): Promise<void> {
    console.log('\n2. å®‰è£…ä¾èµ–...')

    if (!existsSync('node_modules')) {
      console.log('   æ­£åœ¨å®‰è£… npm åŒ…...')
      execSync('npm install', { stdio: 'inherit' })
    }

    console.log('   âœ“ ä¾èµ–å·²å®‰è£…')
  }

  /**
   * æ£€æµ‹é¡¹ç›®ç±»å‹
   */
  private async detectProjectType(): Promise<ProjectType> {
    console.log('\n3. æ£€æµ‹é¡¹ç›®ç±»å‹...')

    // æ£€æŸ¥ package.json
    if (existsSync('package.json')) {
      const pkg = JSON.parse(readFileSync('package.json', 'utf-8'))

      if (pkg.dependencies?.react) {
        console.log('   âœ“ æ£€æµ‹åˆ° React é¡¹ç›®')
        return 'react'
      }

      if (pkg.dependencies?.vue) {
        console.log('   âœ“ æ£€æµ‹åˆ° Vue é¡¹ç›®')
        return 'vue'
      }
    }

    console.log('   âœ“ æ£€æµ‹åˆ°é€šç”¨é¡¹ç›®')
    return 'generic'
  }

  /**
   * ç”Ÿæˆé…ç½®æ–‡ä»¶
   */
  private async generateConfig(projectType: ProjectType): Promise<void> {
    console.log('\n4. ç”Ÿæˆé…ç½®æ–‡ä»¶...')

    // ç”Ÿæˆ .claude.json
    const claudeConfig = {
      mcpServers: {
        docDD: {
          command: 'npm',
          args: ['run', 'mcp'],
          env: {
            DOC_PATH: 'project-docs'
          }
        }
      }
    }

    writeFileSync('.claude.json', JSON.stringify(claudeConfig, null, 2))
    console.log('   âœ“ åˆ›å»º .claude.json')

    // ç”Ÿæˆæ–‡æ¡£éª¨æ¶
    await this.generateDocSkeleton(projectType)
  }

  /**
   * ç”Ÿæˆæ–‡æ¡£éª¨æ¶
   */
  private async generateDocSkeleton(projectType: ProjectType): Promise<void> {
    const docsDir = 'project-docs'

    if (!existsSync(docsDir)) {
      mkdirSync(docsDir, { recursive: true })

      // ç”Ÿæˆé¡¹ç›®æ¦‚è§ˆ
      const overview = `# é¡¹ç›®æ¦‚è§ˆ

## é¡¹ç›®åç§°
${process.cwd().split('/').pop()}

## é¡¹ç›®ç±»å‹
${projectType}

## æŠ€æœ¯æ ˆ
- å¾…è¡¥å……

## æ ¸å¿ƒåŠŸèƒ½
- å¾…è¡¥å……

## å¿«é€Ÿå¼€å§‹
1. å®‰è£…ä¾èµ–
2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
3. å¼€å§‹å¼€å‘
`

      writeFileSync(join(docsDir, '00-é¡¹ç›®æ¦‚è§ˆ.md'), overview)
      console.log('   âœ“ åˆ›å»º project-docs/00-é¡¹ç›®æ¦‚è§ˆ.md')
    }
  }

  /**
   * å¯åŠ¨æœåŠ¡
   */
  private async startServices(): Promise<void> {
    console.log('\n5. å¯åŠ¨æœåŠ¡...')

    // æ£€æŸ¥ç«¯å£å ç”¨
    const availablePort = await this.findAvailablePort(5175)

    // å¯åŠ¨ Web UI
    console.log('   æ­£åœ¨å¯åŠ¨ Web UI...')
    const uiProcess = spawn('npm', ['run', 'dev'], {
      detached: true,
      stdio: 'ignore'
    })

    uiProcess.unref()
    console.log(`   âœ“ Web UI å·²å¯åŠ¨: http://localhost:${availablePort}`)

    // å¯åŠ¨ MCP Server
    console.log('   æ­£åœ¨å¯åŠ¨ MCP Server...')
    const mcpProcess = spawn('npm', ['run', 'mcp'], {
      detached: true,
      stdio: 'ignore'
    })

    mcpProcess.unref()
    console.log('   âœ“ MCP Server å·²å¯åŠ¨')
  }

  /**
   * é›†æˆ Claude Code
   */
  private async integrateClaudeCode(): Promise<void> {
    console.log('\n6. é›†æˆ Claude Code...')

    try {
      // æ£€æŸ¥ Claude Code æ˜¯å¦è¿è¡Œ
      execSync('pgrep -f "claude"', { stdio: 'ignore' })

      console.log('   âœ“ Claude Code å·²é›†æˆ')
      console.log('   ğŸ’¡ åœ¨ Claude Code ä¸­è¾“å…¥: `è¯·è¯»å–é¡¹ç›®æ–‡æ¡£`')
    } catch {
      console.log('   âš  Claude Code æœªè¿è¡Œï¼Œå°†åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é›†æˆ')
    }
  }

  /**
   * æŸ¥æ‰¾å¯ç”¨ç«¯å£
   */
  private async findAvailablePort(startPort: number): Promise<number> {
    // å®ç°ç«¯å£æ£€æµ‹é€»è¾‘
    return startPort
  }
}
```

#### ä½¿ç”¨æ–¹å¼

```bash
# æ–¹å¼1: npxï¼ˆæ¨èï¼‰
npx docdd init

# æ–¹å¼2: æœ¬åœ°å®‰è£…åä½¿ç”¨
npm install -g docdd
docdd init

# æ–¹å¼3: ç›´æ¥è¿è¡Œ
node dist/cli/index.js init
```

---

### æ–¹æ¡ˆ 2: æ–‡æ¡£å˜æ›´ç›‘å¬å’Œ AI ä»»åŠ¡è§¦å‘å™¨

**å®ç°**ï¼šç›‘å¬æ–‡æ¡£å˜æ›´ â†’ å¯è§†åŒ–ä»»åŠ¡é€‰æ‹© â†’ è§¦å‘ AI æ‰§è¡Œ

#### æŠ€æœ¯æ¶æ„

```
docs/      â† æ–‡æ¡£ä¿®æ”¹
   â†“
æ–‡ä»¶ç›‘å¬å™¨ (chokidar)
   â†“
å˜æ›´åˆ†æå™¨ (åˆ†æå˜æ›´å†…å®¹)
   â†“
ä»»åŠ¡æ¨èå™¨ (æ¨èç›¸å…³ä»»åŠ¡)
   â†“
å¯è§†åŒ–UI (ç”¨æˆ·é€‰æ‹©ç¡®è®¤)
   â†“
ä»»åŠ¡è°ƒåº¦å™¨ (è°ƒç”¨ Claude API)
   â†“
ç»“æœå±•ç¤ºå™¨ (æ˜¾ç¤ºæ‰§è¡Œç»“æœ)
```

#### æ ¸å¿ƒå®ç°

```typescript
// src/services/doc-watcher.service.ts
import chokidar from 'chokidar'

export class DocWatcherService {
  private watcher: chokidar.FSWatcher
  private changeBuffer: Array<
    DocChange & { timestamp: number; analyzed: boolean }
  > = []

  constructor(private docPath: string) {
    this.watcher = chokidar.watch(`${docPath}/**/*.md`, {
      ignored: /node_modules/,
      persistent: true,
      ignoreInitial: true
    })

    this.setupWatchers()
  }

  private setupWatchers(): void {
    this.watcher
      .on('add', (path) => this.handleChange('add', path))
      .on('change', (path) => this.handleChange('change', path))
      .on('unlink', (path) => this.handleChange('delete', path))
  }

  /**
   * å¤„ç†æ–‡æ¡£å˜æ›´
   */
  private async handleChange(type: 'add' | 'change' | 'delete', path: string): Promise<void> {
    console.log(`ğŸ“„ æ–‡æ¡£ ${type}: ${path}`)

    const change: DocChange = {
      type,
      path,
      content: type !== 'delete' ? await this.readFile(path) : '',
      timestamp: Date.now()
    }

    // åˆ†æå˜æ›´
    const analysis = await this.analyzeChange(change)

    // æ·»åŠ åˆ°ç¼“å†²åŒº
    this.changeBuffer.push({
      ...change,
      timestamp: Date.now(),
      analyzed: false
    })

    // è§¦å‘ä»»åŠ¡æ¨è
    await this.recommendTasks(analysis)
  }

  /**
   * åˆ†æå˜æ›´å†…å®¹
   */
  private async analyzeChange(change: DocChange): Promise<ChangeAnalysis> {
    // è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæå–å…³é”®è¯
    const keywords = await this.extractKeywords(change.content)

    // åˆ†æå˜æ›´ç±»å‹
    const changeType = this.classifyChange(change)

    return {
      path: change.path,
      type: change.type,
      keywords,
      changeType,
      severity: this.calculateSeverity(changeType, keywords)
    }
  }

  /**
   * æå–å…³é”®è¯
   */
  private async extractKeywords(content: string): Promise<string[]> {
    // ä½¿ç”¨ç®€å•çš„å…³é”®è¯æå–
    // å®é™…å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„NLPç®—æ³•
    const words = content.match(/\b[\u4e00-\u9fa5a-zA-Z]{2,10}\b/g) || []
    const frequency: Record<string, number> = {}

    words.forEach(word => {
      if (word.length > 2) {
        frequency[word] = (frequency[word] || 0) + 1
      }
    })

    return Object.entries(frequency)
      .sort(([, a], [, b]) => b - a)
      .slice(0, 10)
      .map(([word]) => word)
  }

  /**
   * åˆ†ç±»å˜æ›´ç±»å‹
   */
  private classifyChange(change: DocChange): ChangeType {
    // ç®€å•å®ç°ï¼Œå®é™…å¯ä»¥æ›´å¤æ‚
    if (change.type === 'add') return 'new-doc'
    if (change.content.length > 1000) return 'major-update'
    return 'minor-update'
  }

  /**
   * è®¡ç®—ä¸¥é‡ç¨‹åº¦
   */
  private calculateSeverity(changeType: ChangeType, keywords: string[]): 'low' | 'medium' | 'high' {
    const criticalKeywords = ['æ¶æ„', 'æ ¸å¿ƒ', 'API', 'æ•°æ®åº“', 'å®‰å…¨']
    const hasCritical = keywords.some(k => criticalKeywords.includes(k))

    if (hasCritical) return 'high'
    if (changeType === 'new-doc') return 'medium'
    return 'low'
  }

  /**
   * æ¨èä»»åŠ¡
   */
  private async recommendTasks(analysis: ChangeAnalysis): Promise<void> {
    console.log('ğŸ¤– åˆ†æåˆ°æ–‡æ¡£å˜æ›´ï¼Œæ¨èç›¸å…³ä»»åŠ¡...')

    const tasks = await this.generateTaskRecommendations(analysis)

    // è§¦å‘ UI æ›´æ–°
    this.notifyUI(tasks)
  }

  /**
   * ç”Ÿæˆä»»åŠ¡æ¨è
   */
  private async generateTaskRecommendations(analysis: ChangeAnalysis): Promise<AITaskRecommendation[]> {
    const recommendations: AITaskRecommendation[] = []

    // åŸºäºå˜æ›´ç±»å‹æ¨èä»»åŠ¡
    switch (analysis.changeType) {
      case 'new-doc':
        recommendations.push({
          id: 'review-new-doc',
          title: 'å®¡æŸ¥æ–°æ–‡æ¡£',
          description: 'å®¡æŸ¥æ–°åˆ›å»ºçš„æ–‡æ¡£ï¼Œç¡®ä¿å†…å®¹å®Œæ•´ã€æ ¼å¼æ­£ç¡®',
          priority: 'high',
          icon: 'ğŸ‘€',
          estimatedTime: '5-10åˆ†é’Ÿ'
        })
        break

      case 'major-update':
        recommendations.push({
          id: 'update-related-docs',
          title: 'æ›´æ–°ç›¸å…³æ–‡æ¡£',
          description: 'æ–‡æ¡£æœ‰é‡å¤§æ›´æ–°ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ç›¸å…³æ¨¡å—çš„æ–‡æ¡£',
          priority: 'medium',
          icon: 'ğŸ”„',
          estimatedTime: '10-15åˆ†é’Ÿ'
        })

        recommendations.push({
          id: 'check-code-consistency',
          title: 'æ£€æŸ¥ä»£ç ä¸€è‡´æ€§',
          description: 'æ£€æŸ¥æ–‡æ¡£æè¿°æ˜¯å¦ä¸ä»£ç å®ç°ä¸€è‡´',
          priority: 'medium',
          icon: 'ğŸ’»',
          estimatedTime: '15-20åˆ†é’Ÿ'
        })
        break

      case 'minor-update':
        recommendations.push({
          id: 'validate-changes',
          title: 'éªŒè¯å˜æ›´',
          description: 'éªŒè¯æ–‡æ¡£å˜æ›´çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§',
          priority: 'low',
          icon: 'âœ…',
          estimatedTime: '3-5åˆ†é’Ÿ'
        })
        break
    }

    // åŸºäºå…³é”®è¯æ¨èä»»åŠ¡
    if (analysis.keywords.some(k => k.includes('API'))) {
      recommendations.push({
        id: 'update-api-docs',
        title: 'æ›´æ–° API æ–‡æ¡£',
        description: 'æ£€æµ‹åˆ° API ç›¸å…³å˜æ›´ï¼Œå»ºè®®æ›´æ–° API è§„èŒƒæ–‡æ¡£',
        priority: 'high',
        icon: 'ğŸ”Œ',
        estimatedTime: '10-15åˆ†é’Ÿ'
      })
    }

    if (analysis.keywords.some(k => k.includes('æ¶æ„'))) {
      recommendations.push({
        id: 'review-architecture',
        title: 'å®¡æŸ¥æ¶æ„è®¾è®¡',
        description: 'æ£€æµ‹åˆ°æ¶æ„ç›¸å…³å˜æ›´ï¼Œå»ºè®®å®¡æŸ¥æ¶æ„è®¾è®¡æ–‡æ¡£',
        priority: 'high',
        icon: 'ğŸ—ï¸',
        estimatedTime: '20-30åˆ†é’Ÿ'
      })
    }

    return recommendations
  }

  /**
   * é€šçŸ¥ UI
   */
  private notifyUI(tasks: AITaskRecommendation[]): void {
    // è¿™é‡Œå¯ä»¥å‘é€ WebSocket æ¶ˆæ¯æˆ–è§¦å‘ React çŠ¶æ€æ›´æ–°
    console.log(`ğŸ’¡ å‘ç° ${tasks.length} ä¸ª AI ä»»åŠ¡å»ºè®®ï¼š`)
    tasks.forEach(task => {
      console.log(`   - [${task.priority}] ${task.title}`)
    })

    // è§¦å‘å¼¹çª—æˆ–ä¾§è¾¹æ é€šçŸ¥
    this.triggerNotification(tasks)
  }

  /**
   * è§¦å‘é€šçŸ¥
   */
  private triggerNotification(tasks: AITaskRecommendation[]): void {
    // å®ç°æµè§ˆå™¨é€šçŸ¥
    // æˆ– React ç»„ä»¶çŠ¶æ€æ›´æ–°
  }

  /**
   * æ‰§è¡Œä»»åŠ¡
   */
  public async executeTask(taskId: string): Promise<void> {
    console.log(`ğŸš€ æ‰§è¡Œä»»åŠ¡: ${taskId}`)

    const change = this.changeBuffer.find(c => !c.analyzed)
    if (!change) return

    const analysis = await this.analyzeChange(change)

    // è°ƒç”¨ Claude API æ‰§è¡Œä»»åŠ¡
    const result = await this.callClaudeAPI(taskId, change, analysis)

    // æ ‡è®°ä¸ºå·²åˆ†æ
    change.analyzed = true

    // å±•ç¤ºç»“æœ
    this.showResult(result)
  }

  /**
   * è°ƒç”¨ Claude API
   */
  private async callClaudeAPI(taskId: string, change: DocChange, analysis: ChangeAnalysis): Promise<string> {
    // æ ¹æ®ä»»åŠ¡ç±»å‹è°ƒç”¨ä¸åŒçš„ prompt
    const prompts = {
      'review-new-doc': `è¯·å®¡æŸ¥ä»¥ä¸‹æ–°æ–‡æ¡£ï¼Œæä¾›åé¦ˆå»ºè®®ï¼š\n\n${change.content}`,
      'update-related-docs': `æ–‡æ¡£æœ‰é‡å¤§æ›´æ–°ï¼Œè¯·æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ç›¸å…³æ¨¡å—ï¼š\n\n${change.content}`,
      'check-code-consistency': `è¯·æ£€æŸ¥ä»¥ä¸‹æ–‡æ¡£æè¿°æ˜¯å¦ä¸ä»£ç å®ç°ä¸€è‡´ï¼š\n\n${change.content}`,
      // ...
    }

    const prompt = prompts[taskId as keyof typeof prompts]

    if (!prompt) return 'æœªçŸ¥ä»»åŠ¡ç±»å‹'

    // å®é™…è°ƒç”¨ Claude API
    // const response = await claude.messages.create({ ... })

    return `æ¨¡æ‹Ÿæ‰§è¡Œç»“æœï¼šå·²å¯¹æ–‡æ¡£ "${change.path}" è¿›è¡Œåˆ†æå’Œå¤„ç†`
  }

  /**
   * å±•ç¤ºç»“æœ
   */
  private showResult(result: string): void {
    // åœ¨ UI ä¸­å±•ç¤ºç»“æœ
    console.log('ğŸ“Š AI ä»»åŠ¡æ‰§è¡Œç»“æœï¼š')
    console.log(result)
  }

  /**
   * è¯»å–æ–‡ä»¶
   */
  private async readFile(path: string): Promise<string> {
    try {
      return await fs.promises.readFile(path, 'utf-8')
    } catch {
      return ''
    }
  }

  /**
   * åœæ­¢ç›‘å¬
   */
  public stop(): Promise<void> {
    return this.watcher.close()
  }
}
```

#### UI é›†æˆ

```typescript
// src/components/ai-task-panel.tsx
import { useEffect, useState } from 'react'
import { Zap, Check, X } from 'lucide-react'

interface AITaskPanelProps {
  watcher: DocWatcherService
}

export function AITaskPanel({ watcher }: AITaskPanelProps) {
  const [tasks, setTasks] = useState<AITaskRecommendation[]>([])
  const [isVisible, setIsVisible] = useState(false)
  const [isExecuting, setIsExecuting] = useState<string | null>(null)

  useEffect(() => {
    // ç›‘å¬æ–‡æ¡£å˜æ›´äº‹ä»¶
    const handleDocChange = (event: CustomEvent) => {
      const recommendedTasks = event.detail.tasks as AITaskRecommendation[]

      setTasks(recommendedTasks)
      setIsVisible(true)

      // å‘é€æµè§ˆå™¨é€šçŸ¥
      if (Notification.permission === 'granted') {
        new Notification('æ–‡æ¡£å·²å˜æ›´', {
          body: `å‘ç° ${recommendedTasks.length} ä¸ª AI ä»»åŠ¡å»ºè®®`,
          icon: '/favicon.ico'
        })
      }
    }

    window.addEventListener('doc-change', handleDocChange as EventListener)

    return () => {
      window.removeEventListener('doc-change', handleDocChange as EventListener)
    }
  }, [])

  const executeTask = async (taskId: string) => {
    setIsExecuting(taskId)

    try {
      await watcher.executeTask(taskId)

      // ç§»é™¤å·²å®Œæˆçš„ä»»åŠ¡
      setTasks(tasks.filter(t => t.id !== taskId))

      // å¦‚æœæ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆï¼Œå…³é—­é¢æ¿
      if (tasks.length === 1) {
        setIsVisible(false)
      }
    } catch (error) {
      console.error('æ‰§è¡Œä»»åŠ¡å¤±è´¥:', error)
    } finally {
      setIsExecuting(null)
    }
  }

  const dismissTask = (taskId: string) => {
    setTasks(tasks.filter(t => t.id !== taskId))

    if (tasks.length === 1) {
      setIsVisible(false)
    }
  }

  if (!isVisible || tasks.length === 0) {
    return null
  }

  return (
    <div className="fixed bottom-4 right-4 w-96 bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden animate-slide-up">
      {/* Header */}
      <div className="flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
        <div className="flex items-center space-x-2">
          <Zap className="text-blue-600" size={20} />
          <h3 className="font-semibold text-gray-900">AI ä»»åŠ¡å»ºè®®</h3>
          <span className="bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded-full">
            {tasks.length}
          </span>
        </div>
        <button
          onClick={() => setIsVisible(false)}
          className="text-gray-400 hover:text-gray-600"
        >
          <X size={18} />
        </button>
      </div>

      {/* Task List */}
      <div className="max-h-96 overflow-y-auto">
        {tasks.map(task => (
          <div
            key={task.id}
            className="border-b border-gray-100 hover:bg-gray-50 transition-colors p-4"
          >
            <div className="flex items-start space-3">
              <div className="mt-1">{task.icon}</div>

              <div className="flex-1 ml-3">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{task.title}</h4>
                    <p className="text-sm text-gray-600 mt-1">
                      {task.description}
                    </p>
                  </div>

                  <div className={`ml-2 px-2 py-1 text-xs rounded-full ${
                    task.priority === 'high'
                      ? 'bg-red-100 text-red-700'
                      : task.priority === 'medium'
                      ? 'bg-yellow-100 text-yellow-700'
                      : 'bg-gray-100 text-gray-700'
                  }`}>
                    {task.priority === 'high' ? 'é«˜' :
                     task.priority === 'medium' ? 'ä¸­' : 'ä½'}ä¼˜å…ˆçº§
                  </div>
                </div>

                <div className="flex items-center justify-between mt-3">
                  <span className="text-xs text-gray-500">
                    â±ï¸ {task.estimatedTime}
                  </span>

                  <div className="flex space-x-2">
                    <button
                      onClick={() => dismissTask(task.id)}
                      className="text-gray-400 hover:text-gray-600"
                      title="å¿½ç•¥"
                    >
                      <X size={16} />
                    </button>

                    <button
                      onClick={() => executeTask(task.id)}
                      disabled={isExecuting === task.id}
                      className="flex items-center space-x-1 px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50"
                    >
                      {isExecuting === task.id ? (
                        <>
                          <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                          <span>æ‰§è¡Œä¸­...</span>
                        </>
                      ) : (
                        <>
                          <Zap size={14} />
                          <span>æ‰§è¡Œ</span>
                        </>
                      )}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* Footer */}
      <div className="p-3 text-center text-xs text-gray-500 bg-gray-50">
        ğŸ’¡ æ ¹æ®æ–‡æ¡£å˜æ›´è‡ªåŠ¨æ¨è
      </div>
    </div>
  )
}
```

#### ä½¿ç”¨æ–¹å¼

ç”¨æˆ·åœ¨ Web UI ä¸­ç¼–è¾‘æ–‡æ¡£åï¼Œå³ä¸‹è§’ä¼šè‡ªåŠ¨å¼¹å‡º AI ä»»åŠ¡å»ºè®®é¢æ¿ï¼š

1. **ç¼–è¾‘æ–‡æ¡£**ï¼šåœ¨ç¼–è¾‘å™¨ä¸­ä¿®æ”¹æ–‡æ¡£
2. **æŸ¥çœ‹å»ºè®®**ï¼šç³»ç»Ÿè‡ªåŠ¨åˆ†æå¹¶æ¨èç›¸å…³ä»»åŠ¡
3. **é€‰æ‹©ä»»åŠ¡**ï¼šæŸ¥çœ‹æ¯ä¸ªä»»åŠ¡çš„æè¿°å’Œä¼˜å…ˆçº§
4. **æ‰§è¡Œä»»åŠ¡**ï¼šç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®ï¼Œè°ƒç”¨ Claude API
5. **æŸ¥çœ‹ç»“æœ**ï¼šåœ¨é¢æ¿ä¸­æ˜¾ç¤ºæ‰§è¡Œç»“æœ

---

## å®Œæ•´ç”¨æˆ·æµç¨‹

### åœºæ™¯ï¼šç”¨æˆ·ä¿®æ”¹äº†ä¸šåŠ¡æ¨¡å—æ–‡æ¡£

```
ç”¨æˆ·åœ¨ Web UI ä¸­ç¼–è¾‘æ–‡æ¡£
    â†“
"ä¸šåŠ¡æ¨¡å—/ç”¨æˆ·ç®¡ç†.md"
    â†“
DocWatcherService æ£€æµ‹åˆ°å˜æ›´
    â†“
åˆ†æå˜æ›´å†…å®¹ï¼ˆå…³é”®è¯ï¼š"ç”¨æˆ·"ã€"è®¤è¯"ã€"æƒé™"ï¼‰
    â†“
ç”Ÿæˆä»»åŠ¡æ¨èï¼š
  â†’ å®¡æŸ¥æ–°å†…å®¹
  â†’ æ›´æ–°ç›¸å…³æ¨¡å—
  â†’ æ£€æŸ¥ä»£ç ä¸€è‡´æ€§
  â†’ æ›´æ–° API æ–‡æ¡£
    â†“
å³ä¸‹è§’å¼¹å‡º AI ä»»åŠ¡é¢æ¿
    â†“
ç”¨æˆ·ç‚¹å‡»"æ‰§è¡Œ"ï¼ˆæ›´æ–° API æ–‡æ¡£ï¼‰
    â†“
è°ƒç”¨ Claude API ç”Ÿæˆ API è§„èŒƒ
    â†“
æ˜¾ç¤ºæ‰§è¡Œç»“æœ
    â†“
ç”¨æˆ·ç¡®è®¤ååº”ç”¨åˆ°æ–‡æ¡£
```

---

## ä¼˜åŠ¿

### ç”¨æˆ·ä½“éªŒä¼˜åŠ¿

1. **é›¶é…ç½®å¯åŠ¨**ï¼š
   ```bash
   npx docdd init  # ä¸€é”®å®Œæˆæ‰€æœ‰é…ç½®
   ```

2. **æ™ºèƒ½æ¨è**ï¼šæ— éœ€æ‰‹åŠ¨æ€è€ƒéœ€è¦æ‰§è¡Œå“ªäº›ä»»åŠ¡

3. **å¯è§†åŒ–äº¤äº’**ï¼šç›´è§‚çš„ç•Œé¢ï¼Œé™ä½ä½¿ç”¨é—¨æ§›

4. **è‡ªåŠ¨åŒ–æµç¨‹**ï¼šå‡å°‘é‡å¤æ€§å·¥ä½œ

### æŠ€æœ¯ä¼˜åŠ¿

1. **chokidar**: é«˜æ•ˆçš„æ–‡ä»¶ç›‘å¬
2. **æ™ºèƒ½åˆ†æ**: åŸºäºå…³é”®è¯å’Œä¸Šä¸‹æ–‡æ¨èä»»åŠ¡
3. **Claude API**: å¼ºå¤§çš„AIèƒ½åŠ›æ‰§è¡Œå¤æ‚ä»»åŠ¡
4. **å®æ—¶åé¦ˆ**: ç«‹å³çœ‹åˆ°ä»»åŠ¡æ‰§è¡Œç»“æœ

---

## å®æ–½è®¡åˆ’

### é˜¶æ®µ1: åˆå§‹åŒ–å‘½ä»¤è¡Œå·¥å…·ï¼ˆæœ¬å‘¨ï¼‰

- [ ] å®ç° `docdd init` å‘½ä»¤
- [ ] ç¯å¢ƒæ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤
- [ ] è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£éª¨æ¶
- [ ] è‡ªåŠ¨é…ç½® Claude Code

### é˜¶æ®µ2: æ–‡æ¡£ç›‘å¬å’Œä»»åŠ¡æ¨èï¼ˆä¸‹å‘¨ï¼‰

- [ ] é›†æˆ chokidar ç›‘å¬æ–‡æ¡£å˜æ›´
- [ ] å®ç°å˜æ›´åˆ†æå™¨
- [ ] è®¾è®¡ä»»åŠ¡æ¨èç®—æ³•
- [ ] åˆ›å»º AITaskPanel ç»„ä»¶

### é˜¶æ®µ3: AI ä»»åŠ¡æ‰§è¡Œï¼ˆä¸‹ä¸‹å‘¨ï¼‰

- [ ] é›†æˆ Claude API
- [ ] å®ç°ä»»åŠ¡æ‰§è¡Œå™¨
- [ ] ç»“æœå±•ç¤ºå’Œç¡®è®¤æœºåˆ¶
- [ ] æµ‹è¯•ä¸åŒä»»åŠ¡ç±»å‹çš„æ•ˆæœ

### é˜¶æ®µ4: ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆæŒç»­ï¼‰

- [ ] æ”¶é›†ç”¨æˆ·åé¦ˆ
- [ ] ä¼˜åŒ–æ¨èç®—æ³•
- [ ] æ·»åŠ æ›´å¤šä»»åŠ¡ç±»å‹
- [ ] å®Œå–„é”™è¯¯å¤„ç†

---

## å…³é”®è®¾è®¡å†³ç­–

### Q1: å¦‚ä½•å¹³è¡¡è‡ªåŠ¨åŒ–å’Œäººå·¥æ§åˆ¶ï¼Ÿ

**A**: é‡‡ç”¨"æ¨è + ç¡®è®¤"æ¨¡å¼ï¼š
- AI è‡ªåŠ¨æ¨èä»»åŠ¡ï¼ˆ70%ï¼‰
- ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œï¼ˆ30%ï¼‰
- é¿å… AI è‡ªåŠ¨ä¿®æ”¹é€ æˆæ„å¤–

### Q2: å¦‚ä½•å¤„ç†è¯¯æŠ¥ï¼Ÿ

**A**: æä¾›"å¿½ç•¥"å’Œ"æ™ºèƒ½å­¦ä¹ "ï¼š
- ç”¨æˆ·å¯ä»¥å¿½ç•¥ä¸ç›¸å…³çš„ä»»åŠ¡
- ç³»ç»Ÿå­¦ä¹ ç”¨æˆ·åå¥½ï¼Œä¼˜åŒ–æ¨è
- ç½®ä¿¡åº¦ä½äºé˜ˆå€¼çš„ä»»åŠ¡ä¸æ˜¾ç¤º

### Q3: å¦‚ä½•ä¿æŠ¤ç”¨æˆ·éšç§ï¼Ÿ

**A**: æœ¬åœ°å¤„ç† + ç”¨æˆ·æˆæƒï¼š
- æ–‡æ¡£ç›‘å¬åœ¨æœ¬åœ°å®Œæˆ
- åªä¸Šä¼ ç¡®è®¤çš„å˜æ›´å†…å®¹åˆ° Claude API
- æä¾›è„±æ•é€‰é¡¹

---

## æ€»ç»“

é€šè¿‡"ä¸€é”®åˆå§‹åŒ– + æ™ºèƒ½ä»»åŠ¡æ¨è + å¯è§†åŒ–è§¦å‘"çš„æ–¹æ¡ˆï¼Œå¯ä»¥å¤§å¹…é™ä½ç”¨æˆ·ä½¿ç”¨é—¨æ§›ï¼Œæå‡æ–‡æ¡£é©±åŠ¨å¼€å‘çš„ä½“éªŒã€‚

æ ¸å¿ƒä»·å€¼ï¼š
- **é›¶é…ç½®**: `npx docdd init` å³å¯å®Œæˆæ‰€æœ‰è®¾ç½®
- **æ™ºèƒ½åŒ–**: è‡ªåŠ¨åˆ†ææ–‡æ¡£å˜æ›´ï¼Œæ¨èç›¸å…³ä»»åŠ¡
- **å¯è§†åŒ–**: ç›´è§‚çš„ UI ç•Œé¢ï¼Œè½»æ¾è§¦å‘ AI ä»»åŠ¡
- **é«˜æ•ˆç‡**: å‡å°‘æ‰‹åŠ¨æ“ä½œï¼Œè‡ªåŠ¨åŒ–é‡å¤å·¥ä½œ
